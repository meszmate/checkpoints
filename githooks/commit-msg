#!/bin/sh
set -e

MSG_FILE="$1"
if [ -z "$MSG_FILE" ] || [ ! -f "$MSG_FILE" ]; then
    exit 0
fi

TMP_FILE="$(mktemp "${TMPDIR:-/tmp}/checkpoints-commit-msg.XXXXXX")"

# Strip attribution trailers/lines that agents may inject.
grep -viE '^[[:space:]]*(co[- ]?authored[- ]?by[[:space:]]*:|generated with|generated by|authored by ai|created by ai)' "$MSG_FILE" > "$TMP_FILE" || true

# Enforce a single-line commit subject by keeping the first non-empty line only.
sed -n '/[^[:space:]]/{s/^[[:space:]]*//;s/[[:space:]]*$//;p;q;}' "$TMP_FILE" > "${TMP_FILE}.trimmed"

mv "${TMP_FILE}.trimmed" "$MSG_FILE"
rm -f "$TMP_FILE"

exit 0
